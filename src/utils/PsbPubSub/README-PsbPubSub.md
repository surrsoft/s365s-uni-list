
# понятия и описание

## понятия

- `!!psb-pubsub!!` - реализация паттерна PubSub (шина событий), TypeScript
- `!!psb-ev-id!!` - идентификатор вида события; к виду события может быть прикреплено 0+ обработчиков `!psb-handler!`
- `!!psb-handler!!` - обработчик события; прикрепляется к тому или иному виду события через `!psb-ev-id!`; обработчики добавляются в `!psb-handlers!`
- `!!psb-h-obj!!` - объект ключами которого являются `!psb-ev-id!s`, а значениями массив обработчиков `!psb-h-arr!`
- `!!psb-h-arr!!` - массив обработчиков
- `!!psb-s-method!!` - метод subscribe(e, h); принимает на вход идентификатор вида события `!psb-ev-id!` (e) и обработчик `!psb-handler!` (h); добавляет `!psb-handler!` в `!psb-h-obj!` по соответствующему ключу `!psb-ev-id!`
- `!!psb-us-method!!` - метод unsubscribe(e,h); принимает на вход идентификатор вида события `!psb-ev-id!` (e) и обработчик `!psb-handler!` (h); удаляется из массива обработчиков `!psb-h-arr!` ключа `e` обработчик `h` (по строгому равенству)
- `!!psb-p-method!!` - асинхронный метод publish(e,p); принимает на вход идентификатор вида события `!psb-ev-id!` (e) и данные `!psb-payload!`; запускает все обработчики вида события `e`, передавая им данные `p`, возвращает `Promise<void>`
- `!!psb-payload!!` - данные передаваемые в обработчики `!psb-handler!` при вызове метода `!psb-p-method!`

## описание

`!!psb-pubsub!!` предоставляет минималистичную шину событий поверх объектов TypeScript. При создании экземпляра класса указываются:

- тип идентификаторов событий `T1` (`string`-литералы);
- мапа полезных нагрузок `T2`, где ключ совпадает с `T1`, а значение — тип `!psb-payload!`.

Внутри поддерживается `!psb-h-obj!`, где каждое событие хранит массив `!psb-h-arr!` из функций-обработчиков. Основные шаги работы:

1. `!psb-s-method!` — добавляет обработчик к событию; при первом обращении массив создаётся.
2. `!psb-us-method!` — удаляет конкретный обработчик (по ссылке) из массива событий.
3. `!psb-p-method!` — асинхронно вызывает все обработчики события (каждый может быть синхронным или асинхронным), передавая типизированный `!psb-payload!`.

Класс не навязывает очередь, гарантии порядка или асинхронность — обработчики выполняются последовательно в том порядке, в котором были добавлены. Комбинируя несколько экземпляров `!psb-pubsub!`, можно организовать модульные каналы коммуникации без прямых зависимостей между компонентами.

### примеры использования

```ts
type PsbEvents = 'user:login' | 'user:logout';

type PsbPayloads = {
  'user:login': { userId: string };
  'user:logout': void;
};

const bus = new PsbPubSub<PsbEvents, PsbPayloads>();

const onLogin = (payload: PsbPayloads['user:login']) => {
  console.log(`Пользователь вошёл: ${payload.userId}`);
};

// подписываемся на событие
bus.subscribe('user:login', onLogin);

// публикуем событие с полезной нагрузкой (возвращает Promise)
await bus.publish('user:login', { userId: '42' });

// отписываем обработчик, когда он больше не нужен
bus.unsubscribe('user:login', onLogin);
```
